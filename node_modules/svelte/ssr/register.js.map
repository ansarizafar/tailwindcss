{"version":3,"file":"register.js","sources":["../src/server-side-rendering/register.js"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { compile } from '../index.ts';\n\nlet compileOptions = {};\n\nfunction capitalise(name) {\n\treturn name[0].toUpperCase() + name.slice(1);\n}\n\nexport default function register(options) {\n\tconst { extensions } = options;\n\n\tif (extensions) {\n\t\t_deregister('.html');\n\t\textensions.forEach(_register);\n\t}\n\n\t// TODO make this the default and remove in v2\n\tif (options) compileOptions = options;\n}\n\nfunction _deregister(extension) {\n\tdelete require.extensions[extension];\n}\n\nfunction _register(extension) {\n\trequire.extensions[extension] = function(module, filename) {\n\t\tconst name = path.basename(filename)\n\t\t\t.slice(0, -path.extname(filename).length)\n\t\t\t.replace(/^\\d/, '_$&')\n\t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n\n\t\tconst options = Object.assign({}, compileOptions, {\n\t\t\tfilename,\n\t\t\tname: capitalise(name),\n\t\t\tgenerate: 'ssr'\n\t\t});\n\n\t\tconst {code} = compile(fs.readFileSync(filename, 'utf-8'), options);\n\n\t\treturn module._compile(code, filename);\n\t};\n}\n\n_register('.html');\n"],"names":["path.basename","path.extname","compile","fs.readFileSync"],"mappings":";;;;;;AAIA,IAAI,cAAc,GAAG,EAAE,CAAC;;AAExB,SAAS,UAAU,CAAC,IAAI,EAAE;CACzB,OAAO,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;CAC7C;;AAED,AAAe,SAAS,QAAQ,CAAC,OAAO,EAAE;CACzC,IAAQ,UAAU,sBAAZ;;CAEN,IAAI,UAAU,EAAE;EACf,WAAW,CAAC,OAAO,CAAC,CAAC;EACrB,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;EAC9B;;;CAGD,IAAI,OAAO,EAAE,EAAA,cAAc,GAAG,OAAO,CAAC,EAAA;CACtC;;AAED,SAAS,WAAW,CAAC,SAAS,EAAE;CAC/B,OAAO,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;CACrC;;AAED,SAAS,SAAS,CAAC,SAAS,EAAE;CAC7B,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,SAAS,MAAM,EAAE,QAAQ,EAAE;EAC1D,MAAM,IAAI,GAAGA,aAAa,CAAC,QAAQ,CAAC;IAClC,KAAK,CAAC,CAAC,EAAE,CAACC,YAAY,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC;IACxC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC;IACrB,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;;EAEjC,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,cAAc,EAAE;GACjD,QAAQ;GACR,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC;GACtB,QAAQ,EAAE,KAAK;GACf,CAAC,CAAC;;EAEH,OAAY,GAAGC,gBAAO,CAACC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,OAAO,CAAC;EAA5D,IAAA,IAAI,YAAL;;EAEN,OAAO,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;EACvC,CAAC;CACF;;AAED,SAAS,CAAC,OAAO,CAAC,CAAC;;;;"}