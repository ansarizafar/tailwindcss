{"version":3,"file":"register.js","sources":["../src/ssr/register.js"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { compile } from '../index.ts';\n\nlet compileOptions = {\n\textensions: ['.html']\n};\n\nfunction capitalise(name) {\n\treturn name[0].toUpperCase() + name.slice(1);\n}\n\nexport default function register(options) {\n\tif (options.extensions) {\n\t\tcompileOptions.extensions.forEach(deregisterExtension);\n\t\toptions.extensions.forEach(registerExtension);\n\t}\n\n\tcompileOptions = options;\n}\n\nfunction deregisterExtension(extension) {\n\tdelete require.extensions[extension];\n}\n\nfunction registerExtension(extension) {\n\trequire.extensions[extension] = function(module, filename) {\n\t\tconst name = path.basename(filename)\n\t\t\t.slice(0, -path.extname(filename).length)\n\t\t\t.replace(/^\\d/, '_$&')\n\t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n\n\t\tconst options = Object.assign({}, compileOptions, {\n\t\t\tfilename,\n\t\t\tname: capitalise(name),\n\t\t\tgenerate: 'ssr'\n\t\t});\n\n\t\tconst { js } = compile(fs.readFileSync(filename, 'utf-8'), options);\n\n\t\treturn module._compile(js.code, filename);\n\t};\n}\n\nregisterExtension('.html');"],"names":["let","const","path.basename","path.extname","compile","fs.readFileSync"],"mappings":";;;;;;AAIAA,IAAI,cAAc,GAAG;CACpB,UAAU,EAAE,CAAC,OAAO,CAAC;CACrB,CAAC;;AAEF,SAAS,UAAU,CAAC,IAAI,EAAE;CACzB,OAAO,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;CAC7C;;AAED,AAAe,SAAS,QAAQ,CAAC,OAAO,EAAE;CACzC,IAAI,OAAO,CAAC,UAAU,EAAE;EACvB,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,mBAAmB,CAAC,CAAC;EACvD,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;EAC9C;;CAED,cAAc,GAAG,OAAO,CAAC;CACzB;;AAED,SAAS,mBAAmB,CAAC,SAAS,EAAE;CACvC,OAAO,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;CACrC;;AAED,SAAS,iBAAiB,CAAC,SAAS,EAAE;CACrC,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,SAAS,MAAM,EAAE,QAAQ,EAAE;EAC1DC,IAAM,IAAI,GAAGC,aAAa,CAAC,QAAQ,CAAC;IAClC,KAAK,CAAC,CAAC,EAAE,CAACC,YAAY,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC;IACxC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC;IACrB,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;;EAEjCF,IAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,cAAc,EAAE;GACjD,QAAQ;GACR,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC;GACtB,QAAQ,EAAE,KAAK;GACf,CAAC,CAAC;;EAEH,OAAY,GAAGG,gBAAO,CAACC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,OAAO;EAA1D,gBAA4D;;EAEpE,OAAO,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;EAC1C,CAAC;CACF;;AAED,iBAAiB,CAAC,OAAO,CAAC;;;;"}